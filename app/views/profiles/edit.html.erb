<section class="py-5">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-6 d-flex flex-column gap-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <p class="text-uppercase text-primary fw-semibold mb-2">Profile</p>
            <h1 class="fs-4 fw-semibold mb-4">プロフィール設定</h1>

            <% if @user.errors[:name].present? %>
              <%= render "shared/form_errors", object: @user %>
            <% end %>

            <%= form_with model: @user, url: profile_path, method: :patch do |form| %>
              <div class="mb-3">
                <%= form.label :name, "名前", class: "form-label" %>
                <%= form.text_field :name, autofocus: true, class: "form-control" %>
              </div>

              <%= form.submit "更新する", class: "btn btn-primary" %>
            <% end %>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <p class="text-uppercase text-primary fw-semibold mb-2">Account</p>
            <h2 class="fs-5 fw-semibold mb-3">メールアドレス</h2>

            <% if @user.pending_reconfirmation? %>
              <div class="alert alert-warning small" role="alert">
                新しいメールアドレス <strong><%= @user.unconfirmed_email %></strong> の確認待ちです。メールに届いた確認リンクを開いて変更を完了してください。
              </div>
            <% end %>

            <% if @user.errors[:email].present? %>
              <%= render "shared/form_errors", object: @user %>
            <% end %>

            <%= form_with model: @user, url: email_profile_path, method: :patch do |form| %>
              <div class="mb-3">
                <%= form.label :email, "メールアドレス", class: "form-label" %>
                <%= form.email_field :email, class: "form-control", value: @user.email %>
              </div>

              <%= form.submit "メールアドレスを更新", class: "btn btn-outline-primary" %>
            <% end %>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="fs-5 fw-semibold mb-3">パスワード</h2>

            <% if @password_error.present? %>
              <div class="alert alert-danger" role="alert"><%= @password_error %></div>
            <% elsif (@user.errors[:password].present? || @user.errors[:password_confirmation].present?) %>
              <%= render "shared/form_errors", object: @user %>
            <% end %>

            <%= form_with model: @user, url: password_profile_path, method: :patch do |form| %>
              <div class="mb-3">
                <%= form.label :current_password, "現在のパスワード", class: "form-label" %>
                <%= form.password_field :current_password, class: "form-control" %>
              </div>
              <div class="mb-3">
                <%= form.label :password, "新しいパスワード", class: "form-label" %>
                <%= form.password_field :password, class: "form-control" %>
              </div>
              <div class="mb-4">
                <%= form.label :password_confirmation, "新しいパスワード(確認)", class: "form-label" %>
                <%= form.password_field :password_confirmation, class: "form-control" %>
              </div>

              <%= form.submit "パスワードを更新", class: "btn btn-outline-secondary" %>
            <% end %>
          </div>
        </div>

        <details class="card shadow-sm border-danger">
          <summary class="card-header bg-transparent border-0 text-danger fw-semibold pointer">
            アカウント削除
          </summary>
          <div class="card-body">
            <p class="text-body-secondary">
              アカウントを削除すると復元できません。確認のために現在の名前（<strong><%= @user.name %></strong>）を入力してください。
            </p>

            <%= form_with url: profile_path, method: :delete do |form| %>
              <% if @deletion_error.present? %>
                <div class="alert alert-danger" role="alert"><%= @deletion_error %></div>
              <% end %>

              <div class="mb-3">
                <%= form.label :confirm_name, "確認用の名前", class: "form-label" %>
                <%= form.text_field :confirm_name, class: "form-control" %>
              </div>

              <%= form.submit "アカウントを削除する",
                              class: "btn btn-outline-danger",
                              data: { turbo_confirm: "本当に削除してよろしいですか？" } %>
            <% end %>
          </div>
        </details>
      </div>

      <div class="col-lg-6">
        <!-- Empty column kept for layout symmetry / future settings -->
      </div>
    </div>
  </div>
</section>
